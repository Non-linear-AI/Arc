# Arc Tool Definitions
# This file defines all tools available to the Arc agent.
# Tools are loaded dynamically and converted to ArcTool instances.

tools:
  - name: view_file
    description: View contents of a file or list directory contents
    parameters:
      type: object
      properties:
        path:
          type: string
          description: Path to file or directory to view
        start_line:
          type: integer
          description: Starting line number for partial file view (optional)
        end_line:
          type: integer
          description: Ending line number for partial file view (optional)
      required:
        - path

  - name: create_file
    description: Create a new file with specified content
    parameters:
      type: object
      properties:
        path:
          type: string
          description: Path where the file should be created
        content:
          type: string
          description: Content to write to the file
      required:
        - path
        - content

  - name: edit_file
    description: Edit an existing file by replacing text using EXACT string matching. The old_str must match exactly including whitespace and line breaks. If the string is not found or appears multiple times, the tool will return a clear error. Use view_file first to see the exact text to match.
    parameters:
      type: object
      properties:
        path:
          type: string
          description: Path to the file to edit
        old_str:
          type: string
          description: Text to replace (must match exactly including all whitespace and line breaks)
        new_str:
          type: string
          description: Text to replace with
        replace_all:
          type: boolean
          description: Replace all occurrences (default false, only replaces first occurrence)
      required:
        - path
        - old_str
        - new_str

  - name: bash
    description: Execute a bash command
    parameters:
      type: object
      properties:
        command:
          type: string
          description: The bash command to execute
      required:
        - command

  - name: search
    description: Unified search tool for finding text content or files
    parameters:
      type: object
      properties:
        query:
          type: string
          description: Text to search for or file name/path pattern
        search_type:
          type: string
          enum:
            - text
            - files
            - both
          description: "Type of search: 'text' for content search, 'files' for file names, 'both' for both (default: 'both')"
        include_pattern:
          type: string
          description: "Glob pattern for files to include (e.g. '*.ts', '*.js')"
        exclude_pattern:
          type: string
          description: "Glob pattern for files to exclude (e.g. '*.log', 'node_modules')"
        case_sensitive:
          type: boolean
          description: Whether search should be case sensitive (default false)
        whole_word:
          type: boolean
          description: Whether to match whole words only (default false)
        regex:
          type: boolean
          description: Whether query is a regex pattern (default false)
        max_results:
          type: integer
          description: Maximum number of results to return (default 50)
        file_types:
          type: array
          items:
            type: string
          description: "File types to search (e.g. ['js', 'ts', 'py'])"
        include_hidden:
          type: boolean
          description: Whether to include hidden files (default false)
      required:
        - query

  - name: create_todo_list
    description: Create a new todo list for planning and tracking tasks
    parameters:
      type: object
      properties:
        todos:
          type: array
          description: Array of todo items to create
          items:
            type: object
            properties:
              id:
                type: string
                description: Unique identifier for the todo item
              content:
                type: string
                description: Description of the todo item
              status:
                type: string
                enum:
                  - pending
                  - completed
                description: Current status of the todo item (default pending)
            required:
              - id
              - content
              - status
      required:
        - todos

  - name: update_todo_list
    description: Update existing todos in the todo list by ID
    parameters:
      type: object
      properties:
        updates:
          type: array
          description: Array of todo updates
          items:
            type: object
            properties:
              id:
                type: string
                description: ID of the todo item to update
              status:
                type: string
                enum:
                  - pending
                  - completed
                description: New status for the todo item
              content:
                type: string
                description: New content for the todo item
              priority:
                type: string
                enum:
                  - high
                  - medium
                  - low
                description: New priority for the todo item
            required:
              - id
      required:
        - updates

  - name: database_query
    description: |
      Execute READ-ONLY SQL queries (SELECT, SHOW, DESCRIBE) for data exploration and analysis.
      Returns results immediately without confirmation. For data transformations that write/modify
      data (INSERT, UPDATE, DELETE, CREATE TABLE, etc.), use data_process instead.
    parameters:
      type: object
      properties:
        query:
          type: string
          description: SQL query to execute
        target_db:
          type: string
          enum:
            - system
            - user
          description: "Target database: 'system' for read-only queries (default), 'user' for full SQL access"
        validate_schema:
          type: boolean
          description: Whether to validate query against database schema (default true)
      required:
        - query

  - name: schema_discovery
    description: Discover and explore database schema information
    parameters:
      type: object
      properties:
        action:
          type: string
          enum:
            - list_tables
            - describe_table
            - show_schema
          description: "Schema discovery action: 'list_tables' shows all tables, 'describe_table' shows detailed table structure, 'show_schema' shows complete database overview"
        target_db:
          type: string
          enum:
            - system
            - user
          description: "Target database: 'system' for Arc metadata, 'user' for training data (default: system)"
        table_name:
          type: string
          description: Specific table name (required for 'describe_table' action)
      required:
        - action

  - name: ml_plan
    description: |
      Create or revise comprehensive ML workflow plan for a modeling task. This tool
      analyzes data, user requirements, and creates a detailed plan covering feature
      engineering, model architecture, and training/validation strategy (including
      validation metrics to track during training).

      IMPORTANT: Use this tool AFTER exploring the data with schema_discovery and database_query.
      Include data insights in the instruction parameter for better plan quality.

      Use for:
      - Initial plan creation: Provide name, instruction with ML problem description AND data insights
        from exploration (e.g., "Build classifier for X. Data insights: 1000 samples, binary
        classification (70/30 split), 5 numeric features with range 0-100, no missing values.")
      - Plan revision: Use existing plan's name and provide instruction describing the requested changes
        (e.g., "change the model architecture to use 4 layers", "use different features")

      The name parameter is used for versioning (e.g., 'diabetes-classifier' becomes 'diabetes-classifier-v1').
      The instruction parameter is used for both initial creation and revisions.
    parameters:
      type: object
      properties:
        name:
          type: string
          description: |
            Name for the ML plan, used for versioning and identification (e.g., 'diabetes-classifier',
            'fraud-detection-model'). This name will be used to track plan versions in the database.
            Choose a descriptive, kebab-case name suitable for versioning.
        instruction:
          type: string
          description: |
            For initial creation: Description of the ML problem, goals, requirements, AND
            data insights from exploration (sample count, class distribution, feature ranges,
            missing values, correlations, etc.). Including data insights leads to better plans.

            For revisions: Description of the changes to make to the existing plan
            (e.g., "change the model architecture to use 4 layers", "use different features",
            "adjust training strategy to use 100 epochs").

            Example initial instruction with insights:
            "Build binary classifier for diabetes prediction. Data insights: 768 samples,
            binary outcome (500 positive, 268 negative = 35% positive rate), 8 numeric
            features (glucose 0-200, BMI 0-67, age 21-81), no missing values."
        source_tables:
          type: string
          description: Comma-separated list of database tables to analyze (e.g., 'users,transactions' or 'pidd')
      required:
        - name
        - instruction
        - source_tables

  - name: ml_model
    description: |
      Generate Arc-Graph model YAML using the model generator agent. If plan_id is provided,
      the agent will load the plan from the database and use its architecture guidance.
    parameters:
      type: object
      properties:
        name:
          type: string
          description: Model name to include in the specification
        instruction:
          type: string
          description: Description of the intended model behavior and requirements
        data_table:
          type: string
          description: Database table to profile for generation
        target_column:
          type: string
          description: Target column for prediction
        plan_id:
          type: string
          description: |
            Optional ML plan ID to use for model generation (e.g., 'pidd-plan-v1').
            When provided, the agent loads the plan from database and uses its
            architecture guidance (model_architecture_and_loss section).
        recommended_knowledge_ids:
          type: array
          items:
            type: string
          description: |
            Optional list of knowledge IDs recommended by ml_plan (e.g., ['mlp', 'dcn']).
            When provided from ml_plan result, these are displayed in the section metadata
            for visibility and can inform model generation decisions.
      required:
        - name
        - instruction
        - data_table
        - target_column

  - name: ml_train
    description: |
      Generate Arc-Graph trainer specification and launch training. This unified tool:
      1) Generates trainer spec via LLM based on model and training goals,
      2) Presents interactive confirmation workflow,
      3) Auto-registers trainer to database after approval,
      4) Launches training after user confirmation.
      All training configuration (epochs, batch_size, learning_rate, etc.) must be specified
      in the generated trainer YAML - no runtime overrides are supported.
      If plan_id is provided, the agent loads the plan from database and uses its training guidance.
    parameters:
      type: object
      properties:
        name:
          type: string
          description: Trainer name for the specification
        instruction:
          type: string
          description: |
            Training goals, constraints, and requirements. Include all training configuration
            details (epochs, batch size, learning rate, validation strategy, etc.) as these
            will be encoded in the trainer YAML.
        model_id:
          type: string
          description: Model ID with version (e.g., 'my_model-v1')
        train_table:
          type: string
          description: Training data table name
        plan_id:
          type: string
          description: |
            Optional ML plan ID to use for training (e.g., 'pidd-plan-v1').
            When provided, the agent loads the plan from database and uses its
            training guidance (training_configuration section).
        recommended_knowledge_ids:
          type: array
          items:
            type: string
          description: |
            Optional list of knowledge IDs recommended by ml_plan (e.g., ['mlp', 'dcn']).
            When provided from ml_plan result, these are displayed in the section metadata
            for visibility and can inform training decisions.
      required:
        - name
        - instruction
        - model_id
        - train_table

  - name: ml_evaluate
    description: |
      Generate Arc-Graph evaluator specification and launch evaluation job on test data.
      This is an AD HOC tool for evaluating trained models on separate test datasets.
      It is NOT part of the core ML workflow (plan → data → model → train). Validation
      metrics are already tracked during training.

      This unified tool:
      1) Generates evaluator spec via LLM based on evaluation goals,
      2) Presents interactive confirmation workflow,
      3) Auto-registers evaluator to database after approval,
      4) Launches evaluation job and returns immediately with job_id.

      Evaluation runs asynchronously in the background. Monitor progress via /ml jobs status
      and view metrics in TensorBoard. Supports classification metrics (accuracy, precision,
      recall, F1, confusion matrix, PR curves, ROC curves) and regression metrics (MSE, MAE,
      R², scatter plots).

      Use this tool when you need to:
      - Evaluate a trained model on a hold-out test set
      - Compare multiple models on the same test data
      - Generate comprehensive evaluation reports with visualizations
      - Perform threshold tuning or calibration analysis
    parameters:
      type: object
      properties:
        name:
          type: string
          description: Evaluator name for the specification
        instruction:
          type: string
          description: |
            Evaluation goals, constraints, and requirements. Specify which metrics
            to compute and any evaluation-specific notes.
        trainer_id:
          type: string
          description: Trainer ID with version (e.g., 'my-trainer-v1')
        evaluate_table:
          type: string
          description: Test dataset table name for evaluation
        plan_id:
          type: string
          description: |
            Optional ML plan ID (e.g., 'pidd-plan-v1'). When provided, used only
            for context/metadata tracking. The plan no longer contains evaluation
            guidance - evaluation is now ad hoc and independent of the plan.
        recommended_knowledge_ids:
          type: array
          items:
            type: string
          description: |
            Optional list of knowledge IDs recommended by ml_plan (e.g., ['mlp', 'dcn']).
            When provided from ml_plan result, these are displayed in the section metadata
            for visibility and can inform evaluation decisions.
      required:
        - name
        - instruction
        - trainer_id
        - evaluate_table

  - name: ml_data
    description: |
      Generate and execute SQL data processing pipelines for WRITE OPERATIONS.
      Use when users describe data transformations, feature engineering, or operations
      that create/modify tables (INSERT, UPDATE, DELETE, CREATE TABLE, etc.).
      Workflow:
      1) Generate YAML from description,
      2) Show user for review/editing,
      3) Execute pipeline after confirmation,
      4) Create output tables.
      For read-only SELECT queries, use database_query for immediate results.
      If plan_id is provided, the agent loads the plan from database and uses its
      feature engineering guidance.
    parameters:
      type: object
      properties:
        name:
          type: string
          description: Name for the data processor (will be registered in database)
        instruction:
          type: string
          description: Natural language description of data processing requirements
        source_tables:
          type: array
          items:
            type: string
          description: List of source database tables to analyze for generation (required to narrow scope)
        database:
          type: string
          enum:
            - system
            - user
          description: "Target database: 'system' for Arc metadata, 'user' for training data (default: user)"
        plan_id:
          type: string
          description: |
            Optional ML plan ID to use for data processing (e.g., 'pidd-plan-v1').
            When provided, the agent loads the plan from database and uses its
            feature engineering guidance (feature_engineering section).
        recommended_knowledge_ids:
          type: array
          items:
            type: string
          description: |
            Optional list of knowledge IDs recommended by ml_plan (e.g., ['mlp', 'dcn']).
            When provided from ml_plan result, these are displayed in the section metadata
            for visibility and can inform data processing decisions.
      required:
        - name
        - instruction
        - source_tables

  - name: read_knowledge
    description: |
      Read domain knowledge documents to inform model/trainer/evaluator generation.
      Knowledge includes architectures (dcn, transformer), patterns (feature-interaction,
      regularization), and scenarios (fraud-detection, churn-prediction).

      Use this tool to:
      - Understand architecture details and implementation guidance
      - Learn problem-specific patterns and best practices
      - Discover relevant techniques and patterns

      Available knowledge is listed in your context. Read relevant documents before
      generating specifications to ensure high-quality outputs.
    parameters:
      type: object
      properties:
        knowledge_id:
          type: string
          description: "ID of the knowledge to read (e.g., 'dcn', 'feature-interaction')"
        phase:
          type: string
          enum: [model, trainer, evaluator]
          description: "Which phase guide to read (default: model)"
      required:
        - knowledge_id
